require 'spec_helper'

# find all parameters that don't have default values and put in here
# ensure validation occurs
describe Puppet::Type.type(<%= name.inspect.to_sym %>) do
  # these should be only the require parameters
  let(:required_properties) do
    {

      :name => 'some_name'
    }
  end

  let(:optional_properies) do
     {

     }
  end

  let(:properties) do
     required_properties.merge(optional_properties)
  end

  let(:name) do
     'some_name'
  end


  #
describe 'invalid' do
      let(:properties) do
        {
          :name       => [],
          :ensure     => 'present',
          :package    => 'com.ibm.websphere.NDTRIAL.v85',
          :version    => '8.5.5000.20130514_1044',
          :target     => '/opt/IBM/WebSphere/AppServer',
          :repository => '/vagrant/ibm/was/repository.config',
        }
      end
      it 'should raise ArgumentError if not valid value' do
        expect{ type_instance}.to raise_error(Puppet::ResourceError)
      end
    end
    describe 'valid' do
      let(:properties) do
        {
          :name       => '/opt/IBM/WebSphere/AppServer',
          :ensure     => 'present',
          :package    => 'com.ibm.websphere.NDTRIAL.v85',
          :version    => '8.5.5000.20130514_1044',
          :target     => '/opt/IBM/WebSphere/AppServer',
          :repository => '/vagrant/ibm/was/repository.config',
        }
      end
      it 'should validate and pass if valid value' do
        expect(type_instance).to be_instance_of Puppet::Type::Ibm_pkg
      end
    end



  #
  let(:type_instance) do
    #
    Puppet::Type.type(<%= name.inspect.to_sym %>).new(:name => name) 
  end
  <%- parameters.each do |param| %>
  describe <%= param.inspect %> do
    it 'should have a <%= param %> parameter' do
      expect(Puppet::Type.type(<%= name.inspect.to_sym %>).attrtype(<%= param.inspect %>)).to eq(:param)
    end
    <%- if param == :name -%>
    it 'should raise ArgumentError if not valid value' do
      expect { Puppet::Type.type(<%= name.inspect.to_sym %>).new(:name => name, :ensure => :present) }.to raise_error(Puppet::ResourceError)
    end
    it 'should validate and pass if valid value' do
      expect(Puppet::Type.type(<%= name.inspect %>).new(:name => name, :ensure => :present)).to eq('')
    end
    <%- else -%>
    it 'should raise ArgumentError if not valid value' do
      expect do
        Puppet::Type.type(<%= name.inspect.to_sym %>).new(:name => name, :ensure => :present, <%= param.inspect %> => 'some_bad_value')
      end.to raise_error(Puppet::ResourceError)
    end
    it 'should validate and pass if valid value' do
      expect(Puppet::Type.type(<%= name.inspect %>).new(:name => name, :ensure => :present, <%= param.inspect%> => 'some_value')).to eq('')
    end
    <%- end -%>
  end
 <%- end -%>
  <%- properties.each do |prop| %>
  describe <%= prop.inspect %> do
    it 'should have a <%= prop %> property' do
      expect(Puppet::Type.type(<%= name.inspect.to_sym %>).attrtype(<%= prop.inspect %>)).to eq(:property)
    end
    it 'should raise ArgumentError if not valid value' do
      expect do
        Puppet::Type.type(<%= name.inspect.to_sym %>).new(:name => name, :ensure => :present, <%= prop.inspect -%> => 'some_bad_value')
      end.to raise_error(Puppet::ResourceError)
    end
    it 'should validate and pass if valid value' do
      expect(Puppet::Type.type(<%= name.inspect.to_sym %>).new(:name => name, :ensure => :present, <%= prop.inspect %> => 'some_value')).to eq('')
    end
  end
  <%- end -%>
  <%- instance_methods.each do |meth| %>
  describe 'method <%= meth %>' do
    it { expect(type_instance.<%= meth %>('blah')).to eq('blah') }
  end
  <%- end -%>
end